<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Edit SVR List</title>

<style>
/* ================= DESIGN TOKENS ================= */
:root {
  --primary: #1d4ed8;
  --primary-dark: #1e40af;
  --bg: #eef2f7;
  --card: #ffffff;
  --border: #cbd5e1;
  --text: #111827;
  --muted: #4b5563;
  --danger: #b91c1c;
}

/* ================= BASE ================= */
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 13px;
  background: var(--bg);
  color: var(--text);
  padding: 20px;
}

/* ================= TOP BAR ================= */
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: 8px;
  padding: 14px 18px;
  margin-bottom: 18px;
}

.page-title h1 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
}

.page-title span {
  font-size: 12px;
  color: var(--muted);
}

/* ================= BUTTONS ================= */
button {
  padding: 7px 14px;
  font-size: 13px;
  font-weight: 600;
  border-radius: 4px;
  border: none;
  cursor: pointer;
}

.btn-primary {
  background: var(--primary);
  color: #fff;
}

.btn-primary:hover {
  background: var(--primary-dark);
}

.btn-danger {
  background: #fee2e2;
  color: var(--danger);
  border: 1px solid #fecaca;
}

.btn-danger:hover {
  background: #fecaca;
}

/* ================= CARD ================= */
.card {
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: 8px;
  padding: 16px;
}

/* ================= TABLE ================= */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border: 2px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  background: var(--card);
}

th {
  background: #e2e8f0;
  font-size: 12px;
  font-weight: 700;
  padding: 10px;
  border-bottom: 2px solid var(--border);
  position: sticky;
  top: 0;
}

td {
  padding: 9px;
  border-bottom: 1px solid var(--border);
  font-size: 12px;
  text-align: center;
}

tbody tr:nth-child(even) {
  background: #f8fafc;
}

tbody tr:hover {
  background: #e0f2fe;
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
  <div class="page-title">
    <h1 id="title"></h1>
    <span>Edit & manage list entries</span>
  </div>

  <button class="btn-primary" onclick="goHome()">â¬… Back to Home</button>
</div>

<!-- CONTENT -->
<div class="card">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Location</th>
        <th>Engineer</th>
        <th>WS/OS</th>
        <th>Call Type</th>
        <th>Complaint</th>
        <th>Customer</th>
        <th>Machine No</th>
        <th>HMR</th>
        <th>Status</th>
        <th>Site Location</th>
        <th>Call ID</th>
        <th>Labour</th>
        <th>Distance</th>
        <th>TA+DA</th>
        <th>SVR No</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbwDNZYXD4OkYwOvJ6NoqEsVSZGzyj4_euck_ZGz61Cd5GjKfVfbww8Fyk8t5N-zrJA/exec";

const params = new URLSearchParams(window.location.search);
const LIST_ID = params.get("listId");

document.getElementById("title").textContent =
  "Editing List : " + LIST_ID;

loadRows();

function loadRows() {
  const cb = "rows_cb_" + Date.now();
  let script;

  window[cb] = function (items) {
    render(items);
    delete window[cb];
    script.remove();
  };

  script = document.createElement("script");
  script.src =
    `${API_URL}?action=getListRows&listId=${LIST_ID}&callback=${cb}`;
  document.body.appendChild(script);
}

function render(items) {
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  if (!items.length) {
    tbody.innerHTML =
      "<tr><td colspan='17'>No rows found</td></tr>";
    return;
  }

  items.forEach(o => {
    const r = o.row;
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${fmt(r[28])}</td>
      <td>${r[2]}</td>
      <td>${r[3]}</td>
      <td>${r[4]}</td>
      <td>${r[5]}</td>
      <td>${r[6]}</td>
      <td>${r[7]}</td>
      <td>${r[10]}</td>
      <td>${r[11]}</td>
      <td>${r[12]}</td>
      <td>${r[15]}</td>
      <td>${r[21]}</td>
      <td>${r[22]}</td>
      <td>${r[23]}</td>
      <td>${r[27]}</td>
      <td>${r[1]}</td>
      <td>
        <button class="btn-danger" onclick="del(${o.index})">
          Delete
        </button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

function fmt(v) {
  const d = new Date(v);
  return isNaN(d) ? "" : d.toLocaleDateString("en-GB");
}

function del(rowIndex) {
  if (!confirm("Delete this row permanently?")) return;

  const cb = "del_cb_" + Date.now();
  let script;

  window[cb] = () => loadRows();

  script = document.createElement("script");
  script.src =
    `${API_URL}?action=deleteRow&rowIndex=${rowIndex}&callback=${cb}`;
  document.body.appendChild(script);
}

function goHome() {
  window.location.href = "index.html";
}
</script>

</body>
</html>
