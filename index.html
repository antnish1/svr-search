<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>TA DA VERIFICATION PORTAL</title>

<style>
/* ================= DESIGN TOKENS ================= */
:root {
  --yellow: #facc15;
  --yellow-dark: #eab308;
  --black: #0f0f0f;
  --bg: #eef2f7;
  --card: #ffffff;
  --border: #cbd5e1;
  --text: #111827;
  --muted: #6b7280;
  --primary: #1d4ed8;
}

/* ================= BASE ================= */
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 13px;
  background: var(--bg);
  color: var(--text);
  padding: 20px;
}

/* ================= TOP BAR ================= */
.top-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--black);
  border-radius: 10px;
  padding: 16px 22px;
  margin-bottom: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.35);
}

/* LEFT */
.top-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.app-logo {
  height: 60px;
  width: auto;
  border-radius: 6px;
  background: var(--yellow);
  padding: 6px;
}

.app-title h1 {
  margin: 0;
  font-size: 20px;
  font-weight: 800;
  color: var(--yellow);
  letter-spacing: 0.5px;
}

.app-subtitle {
  margin-top: 2px;
  font-size: 12px;
  color: #e5e7eb;
}

/* CENTER SEARCH */
.top-search {
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1;
  justify-content: center;
}

.search-input {
  width: 420px;
  padding: 8px 14px;
  border-radius: 20px;
  border: 2px solid var(--border);
  font-size: 13px;
  background: #f8fafc;
}

.search-input:focus {
  outline: none;
  background: #fff;
  border-color: var(--primary);
}

.filter-wrapper {
  position: relative;
}

.filter-btn {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #e5e7eb;
}

.filter-btn:hover {
  color: var(--yellow);
}

.status-dropdown {
  display: none;
  position: absolute;
  top: 36px;
  right: 0;
  min-width: 150px;
  padding: 6px;
  border-radius: 6px;
  border: 2px solid var(--border);
  background: white;
  z-index: 50;
}

.status-dropdown.show {
  display: block;
}

/* RIGHT BUTTONS */
.create-list {
  display: flex;
  align-items: center;
  gap: 8px;
}

button {
  padding: 8px 14px;
  font-size: 13px;
  font-weight: 700;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

.btn-primary {
  background: var(--yellow);
  color: #111;
}

.btn-primary:hover {
  background: var(--yellow-dark);
}

.btn-secondary {
  background: #1f2933;
  color: #fff;
}

.btn-secondary:hover {
  background: #374151;
}

/* ================= CARD ================= */
.card {
  background: linear-gradient(
    180deg,
    #ffffff 0%,
    #f9fafb 100%
  );
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  padding: 18px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

/* Section title */
.card h3 {
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 16px;
  font-weight: 800;
  color: #111827;
  border-left: 6px solid var(--yellow);
  padding-left: 10px;
}


/* ================= TABLE ================= */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border: 2px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}

th {
  background: linear-gradient(
    180deg,
    #facc15 0%,
    #fde047 100%
  );
  color: #111;
  font-size: 12px;
  font-weight: 800;
  padding: 10px;
  border-bottom: 2px solid #eab308;
}


td {
  padding: 9px;
  border-bottom: 1px solid var(--border);
  font-size: 12px;
  text-align: center;
}

tbody tr:nth-child(even) {
  background: #f8fafc;
}

tbody tr:hover {
  background: #e0f2fe;
}



.badge-open {
  background: #dbeafe;
  color: #1d4ed8;
}

.badge-closed {
  background: #e5e7eb;
  color: #374151;
}

.badge-verified {
  background: #dcfce7;
  color: #15803d;
}

.badge-passed {
  background: #ede9fe;
  color: #6d28d9;
}

  

.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.65);   /* üî• darker backdrop */
  z-index: 10000;
  align-items: center;
  justify-content: center;
}

.modal-overlay.show {
  display: flex;
}


.modal-box {
  background: #ffffff;               /* ‚úÖ solid white */
  border-radius: 10px;
  padding: 24px 26px;
  min-width: 320px;
  max-width: 90%;
  box-shadow: 0 25px 60px rgba(0,0,0,0.45); /* üî• strong elevation */
  animation: popIn 0.2s ease-out;
}

  
  


.row-actions {
  display: flex;
  flex-direction: row;        /* üîë FORCE horizontal */
  justify-content: center;
  align-items: center;
  gap: 8px;
  white-space: nowrap;        /* üîë prevents wrapping */
}

.action-icon {
  flex-shrink: 0;
}

.action-icon {
  cursor: pointer;
}


.action-icon {
  width: 26px;
  height: 26px;
  font-size: 13px;
}


.action-icon {
  transition: 
    background 0.15s ease,
    transform 0.15s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

/* Hover feedback */
.action-icon:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 14px rgba(0,0,0,0.18);
  border-color: var(--yellow);
}


/* Open / View */
.action-icon[title*="Open"]:hover {
  background: #e0f2fe;
  color: #0369a1;
}

/* Edit */
.action-icon[title*="Edit"]:hover {
  background: #fef3c7;
  color: #92400e;
}

/* Preview */
.action-preview:hover {
  background: #bae6fd;
  color: #075985;
}

/* Verify */
.action-icon[title*="Verify"]:hover {
  background: #dcfce7;
  color: #166534;
}

/* Mark Passed */
.action-icon[title*="Mark"]:hover {
  background: #ede9fe;
  color: #6d28d9;
}


.action-icon[style*="pointer-events:none"] {
  opacity: 0.4;
}

.action-icon[style*="pointer-events:none"]:hover {
  transform: none;
  box-shadow: none;
  background: inherit;
  cursor: not-allowed;
}


  
  
  
  
@keyframes popIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

  

  
/* ================= LOADER ================= */
.loader-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,.85);
  z-index: 9999;
  align-items: center;
  justify-content: center;
}

.spinner {
  width: 42px;
  height: 42px;
  border: 4px solid #cbd5e1;
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}



/* Base row style */
#listTable tbody tr {
  transition: background 0.2s ease;
}

/* OPEN */
#listTable tbody tr[data-status="OPEN"] {
  background: #ffffff;
  border-left: 5px solid #3b82f6; /* blue */
}

/* CLOSED */
#listTable tbody tr[data-status="CLOSED"] {
  background: #f9fafb;
  border-left: 5px solid #6b7280; /* gray */
}

/* VERIFIED */
#listTable tbody tr[data-status="VERIFIED"] {
  background: #f0fdf4;
  border-left: 5px solid #16a34a; /* green */
}

/* PASSED */
#listTable tbody tr[data-status="PASSED"] {
  background: #faf5ff;
  border-left: 5px solid #7c3aed; /* purple */
}

/* Hover enhancement */
#listTable tbody tr:hover {
  background: #e0f2fe !important;
}



  
</style>
</head>

<body>

<!-- LOADER -->
<div id="loader" class="loader-overlay">
  <div class="spinner"></div>
</div>

<!-- ================= TOP BAR ================= -->
<div class="top-bar">

  <!-- LEFT -->
  <div class="top-left">
    <img src="logo.png" alt="Company Logo" class="app-logo">
    <div class="app-title">
      <h1>TA DA VERIFICATION PORTAL</h1>
      <div class="app-subtitle">Frontier Commercial Vehicle Pvt. Ltd.</div>
      <div class="app-subtitle">Disclaimer:¬†This website is not affiliated with or endorsed by JCB or Frontier. It has been created solely for personal use. Any unauthorized access, use, or distribution of this website or its content is strictly prohibited. -¬†NISHANT MISHRA
</div>
    </div>
  </div>

  <!-- CENTER -->
  <div class="top-search">
    <input
      type="text"
      id="listSearch"
      placeholder="Search lists by ID or location‚Ä¶"
      onkeyup="filterLists()"
      class="search-input"
    >

    <div class="filter-wrapper">
      <button class="filter-btn" onclick="toggleStatusFilter(event)">‚ò∞</button>
      <select id="statusFilter" class="status-dropdown" onchange="filterLists()">
        <option value="">All Status</option>
        <option value="OPEN">Open</option>
        <option value="CLOSED">Closed</option>
        <option value="VERIFIED">Verified</option>
        <option value="PASSED">Passed</option>
      </select>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="create-list">
    <button class="btn-secondary" onclick="openDashboard()">üìä Dashboard</button>
    <button
      id="loadAllBtn"
      class="btn-secondary"
      onclick="loadAllLists()"
    >
      üìã Load All Lists
    </button>

    <button class="btn-primary" onclick="openCreateListModal()">‚ûï Create List</button>
  </div>

</div>

<p style="font-size:12px;color:#6b7280;margin-bottom:8px">
  Click <b>Load All Lists</b> to fetch latest data
</p>

<!-- LIST TABLE -->
<div class="card">
  <h3>All Lists</h3>

  <table id="listTable">
    <thead>
      <tr>
        <th>List ID</th>
        <th>Date</th>
        <th>Location</th>
        <th>Status</th>
        <th>SVR Count</th>
        <th>Total TA+DA</th>
        <th>Passed Amount</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>



<!-- ================= GENERIC MODAL ================= -->
<div id="modal" class="modal-overlay">
  <div class="modal-box">
    <div id="modal-text" style="margin-bottom:12px"></div>
    <button class="btn-primary" onclick="closeModal()">OK</button>
  </div>
</div>

<!-- ================= CREATE LIST MODAL ================= -->
<div id="createListModal" class="modal-overlay">
  <div class="modal-box">

    <h3 style="margin-top:0">Create New List</h3>
    <p style="font-size:12px;color:#6b7280">
      Select location for this list
    </p>

    <div style="margin:14px 0;text-align:left;max-height:240px;overflow:auto">
    
      <label><input type="radio" name="listLocation" value="DAMOH"> DAMOH</label><br>
      <label><input type="radio" name="listLocation" value="DINDORI"> DINDORI</label><br>
      <label><input type="radio" name="listLocation" value="ANUPPUR"> ANUPPUR</label><br>
      <label><input type="radio" name="listLocation" value="MANDLA"> MANDLA</label><br>
      <label><input type="radio" name="listLocation" value="NARSINGHPUR"> NARSINGHPUR</label><br>
      <label><input type="radio" name="listLocation" value="SEONI"> SEONI</label><br>
      <label><input type="radio" name="listLocation" value="KATNI"> KATNI</label><br>
      <label><input type="radio" name="listLocation" value="BALAGHAT"> BALAGHAT</label><br>
      <label><input type="radio" name="listLocation" value="JABALPUR BHL"> JABALPUR BHL</label><br>
      <label><input type="radio" name="listLocation" value="JABALPUR HL"> JABALPUR HL</label><br>
    
    </div>


    <div style="margin-top:16px">
      <button class="btn-primary" onclick="confirmCreateList()">Create</button>
      <button class="btn-secondary" onclick="closeCreateListModal()">Cancel</button>
    </div>

  </div>
</div>


  
</body>
</html>


<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbwDNZYXD4OkYwOvJ6NoqEsVSZGzyj4_euck_ZGz61Cd5GjKfVfbww8Fyk8t5N-zrJA/exec";

//showLoader(true);
//loadLists();


function loadAllLists() {
  const btn = document.getElementById("loadAllBtn");

  btn.disabled = true;
  btn.textContent = "Loading‚Ä¶";

  showLoader(true);
  loadLists(); // üî• your EXISTING function

  // restore button after load
  setTimeout(() => {
    btn.textContent = "üìã Load All Lists";
    btn.disabled = false;
  }, 800);
}

  
function loadLists() {
  const cb = "lists_cb_" + Date.now();
  let s;

  window[cb] = data => {
    renderLists(data || []);
    showLoader(false);
    document.getElementById("page").style.display = "block";
    cleanup();
  };

  function cleanup() {
    delete window[cb];
    s.remove();
  }

  s = document.createElement("script");
  s.src = `${API_URL}?action=getLists&callback=${cb}`;
  document.body.appendChild(s);
}

function renderLists(lists) {
  const tbody = document.querySelector("#listTable tbody");
  tbody.innerHTML = "";

  if (!lists.length) {
    tbody.innerHTML =
      "<tr><td colspan='8'>No lists found</td></tr>";
    return;
  }

  lists.forEach(l => {
    const tr = document.createElement("tr");

    if (l.status === "PASSED") {
      tr.classList.add("passed-row");
    }

    // üîë for filtering
    tr.dataset.status = l.status;

    // Format amounts safely
    const totalTaDa =
      l.totalTaDa
        ? "‚Çπ" + Number(l.totalTaDa).toLocaleString("en-IN")
        : "";

    const passedAmount =
      l.passedAmount
        ? "‚Çπ" + Number(l.passedAmount).toLocaleString("en-IN")
        : "";

    tr.innerHTML = `
      <td>${l.listId}</td>
      <td>${l.date}</td>
      <td>${l.location}</td>

      <!-- STATUS -->
      <td>${renderStatus(l.status)}</td>

      <td style="font-weight:bold">${l.svrCount}</td>

      <td style="font-weight:bold">
        ${totalTaDa}
      </td>

      <!-- ‚úÖ PASSED AMOUNT -->
      <td style="font-weight:bold; color:${passedAmount ? '#15803d' : '#9ca3af'}">
        ${passedAmount}
      </td>

      <!-- ACTIONS -->
      <td>
        <div class="row-actions">

          <!-- üîí OPEN LIST (PIN PROTECTED) -->
          <div class="action-icon"
            title="Open List"
            onclick="openList('${l.listId}', '${l.location}')"
            ${["VERIFIED","PASSED"].includes(l.status)
              ? 'style="pointer-events:none;opacity:.4"'
              : ""}
            >
            üëÅ
          </div>

          <!-- üîí EDIT LIST (PIN PROTECTED) -->
          <div class="action-icon"
            title="Edit List"
            onclick="editList('${l.listId}', '${l.location}')"
            ${["VERIFIED","PASSED"].includes(l.status)
              ? 'style="pointer-events:none;opacity:.4"'
              : ""}
            >
            ‚úè
          </div>

          <!-- PREVIEW (NO PIN) -->
          <div class="action-icon action-preview"
            title="Preview List"
            onclick="previewList('${l.listId}')">
            üìÑ
          </div>

          ${
            l.status === "CLOSED"
              ? `<div class="action-icon"
                   title="Verify List"
                   onclick="verifyList('${l.listId}')">
                   ‚úî
                 </div>`
              : ""
          }

          ${
            l.status === "VERIFIED"
              ? `<div class="action-icon"
                   title="Mark Passed"
                   onclick="markPassed('${l.listId}')">
                   ‚úÖ
                 </div>`
              : ""
          }

        </div>
      </td>
    `;

    tbody.appendChild(tr);
  });
}





function verifyListConfirmed(listId) {
  showLoader(true);

  const cb = "verify_" + Date.now();
  let s;

  window[cb] = function () {
    showLoader(false);

    // Reload lists so status updates immediately
    loadLists();

    delete window[cb];
    s.remove();
  };

  s = document.createElement("script");
  s.src =
    `${API_URL}?action=verifyList` +
    `&listId=${encodeURIComponent(listId)}` +
    `&callback=${cb}`;

  document.body.appendChild(s);
}


  

function createList(location) {
  // üîí SAFETY CHECK
  if (!location) {
    showModal("Please select a location");
    return;
  }

  showLoader(true);

  const cb = "create_cb_" + Date.now();
  let s;

  window[cb] = listId => {
    sessionStorage.setItem("ACTIVE_LIST_ID", listId);
    window.location.href = "home.html?listId=" + listId;
  };

  s = document.createElement("script");
  s.src =
    `${API_URL}?action=createList` +
    `&location=${encodeURIComponent(location)}` +
    `&callback=${cb}`;

  document.body.appendChild(s);
}

function openList(listId, location) {
  verifyPinForLocation(location, () => {
    sessionStorage.setItem("ACTIVE_LIST_ID", listId);
    window.location.href = "home.html";
  });
}


function editList(listId, location) {
  verifyPinForLocation(location, () => {
    window.location.href = "edit.html?listId=" + listId;
  });
}


function previewList(id) {
  window.open(`${API_URL}?action=preview&listId=${id}`, "_blank");
}


function verifyList(listId) {
  const pwd = prompt("Enter verification password");

  if (pwd === null) return; // Cancel pressed

  if (pwd !== "78612345") {
    showModal("‚ùå Incorrect password. Verification denied.");
    return;
  }

  verifyListConfirmed(listId);
}



  
/* UI helpers */
function showLoader(s){document.getElementById("loader").style.display=s?"flex":"none";}
function showModal(t){document.getElementById("modal-text").innerText=t;document.getElementById("modal").style.display="flex";}
function closeModal(){document.getElementById("modal").style.display="none";}

function renderStatus(status) {
  if (status === "PASSED") {
    return `<span class="badge badge-passed">PASSED</span>`;
  }
  if (status === "VERIFIED") {
    return `<span class="badge badge-verified">VERIFIED</span>`;
  }
  if (status === "CLOSED") {
    return `<span class="badge badge-closed">CLOSED</span>`;
  }
  return `<span class="badge badge-open">OPEN</span>`;
}


function filterLists() {
  const search = document.getElementById("listSearch").value.toLowerCase();
  const status = document.getElementById("statusFilter").value;

  const rows = document.querySelectorAll("#listTable tbody tr");

  rows.forEach(tr => {
    const text = tr.innerText.toLowerCase();
    const rowStatus = tr.dataset.status;

    const matchesText = text.includes(search);
    const matchesStatus = !status || rowStatus === status;

    tr.style.display = matchesText && matchesStatus ? "" : "none";
  });
}

function openCreateListModal() {
  document.getElementById("createListModal").classList.add("show");

  // clear previous selection
  document
    .querySelectorAll("input[name='listLocation']")
    .forEach(r => r.checked = false);
}

function closeCreateListModal() {
  document.getElementById("createListModal").classList.remove("show");
}



const LOCATION_PASSWORDS = {
  "DAMOH": "470776",
  "DINDORI": "481880",
  "ANUPPUR": "484224",
  "MANDLA": "481661",
  "NARSINGHPUR": "487001",
  "SEONI": "480661",
  "KATNI": "483501",
  "BALAGHAT": "481001",
  "JABALPUR BHL": "482001",
  "JABALPUR HL": "482001"
};

  

function verifyPinForLocation(location, onSuccess) {
  if (!location || !LOCATION_PASSWORDS[location]) {
    showModal("‚ùå Access denied (invalid list location)");
    return;
  }

  const correctPin = LOCATION_PASSWORDS[location];
  const enteredPin = prompt(`Enter PIN for ${location}`);

  if (enteredPin === null) return;

  if (enteredPin !== correctPin) {
    showModal("‚ùå Incorrect PIN");
    return;
  }

  onSuccess();
}



function confirmCreateList() {
  const selected = document.querySelector(
    'input[name="listLocation"]:checked'
  );

  if (!selected) {
    showModal("‚ùå Please select a location");
    return;
  }

  const location = selected.value;
  const correctPin = LOCATION_PASSWORDS[location];

  const enteredPin = prompt(`Enter PIN for ${location}`);

  if (enteredPin === null) return; // user cancelled

  // ‚ùå WRONG PIN
  if (enteredPin !== correctPin) {
    // üëá CLOSE create list modal FIRST
    closeCreateListModal();

    // üëá SHOW error popup ABOVE everything
    setTimeout(() => {
      showModal("‚ùå Incorrect PIN");
    }, 50);

    return;
  }

  // ‚úÖ CORRECT PIN
  // üëá CLOSE create list modal IMMEDIATELY
  closeCreateListModal();

  showLoader(true);

  const cb = "create_" + Date.now();
  let s;

  window[cb] = function (listId) {
    showLoader(false);

    if (!listId || listId.error) {
      showModal("‚ùå Failed to create list");
      return;
    }

    // ‚úÖ SAVE & REDIRECT
    sessionStorage.setItem("ACTIVE_LIST_ID", listId);
    window.location.href = "home.html";
  };

  s = document.createElement("script");
  s.src =
    API_URL +
    "?action=createList" +
    "&location=" + encodeURIComponent(location) +
    "&callback=" + cb;

  document.body.appendChild(s);
}







function toggleStatusFilter(e) {
  e.stopPropagation(); // prevent immediate close
  const dd = document.getElementById("statusFilter");
  dd.classList.toggle("show");
}


function markPassed(listId) {
  const pwd = prompt("Enter pass approval password");

  if (pwd === null) return;

  if (pwd !== "000007") {
    showModal("‚ùå Incorrect password");
    return;
  }

  // redirect to passed amount entry screen
  window.location.href = "passed.html?listId=" + listId;
}



function openDashboard() {
  window.location.href = "dashboard.html";
}

  
  
// Close status filter when clicking outside
document.addEventListener("click", function () {
  const dd = document.getElementById("statusFilter");
  if (dd) dd.classList.remove("show");
});

// Prevent dropdown click from closing itself
document
  .getElementById("statusFilter")
  .addEventListener("click", e => e.stopPropagation());

  

  
  
  
</script>

</body>
</html>
